{% extends "base.html" %}
{% block content %}
<div class="page">

  <header class="app-header">
  <div class="brand">
    <span class="logo-dot"></span>
    <span class="logo-text">Speech Studio</span>
  </div>

  <div class="header-right">
    <span class="pill">ASR · Classification · Generation</span>

    <button type="button" id="themeToggle" class="theme-toggle">
      <span class="theme-icon" id="themeIcon"></span>
      <span class="theme-label" id="themeLabel">Dark</span>
    </button>
  </div>
</header>


  <form id="mainForm" method="post" enctype="multipart/form-data" class="layout">
    <!-- Prompt panel -->
    <section class="card">
      <h2>Prompt</h2>
      <p class="muted">Type or speak what you want the model to do.</p>

      <textarea id="promptText" name="prompt_text" class="input prompt-input"
                rows="4" placeholder="Example: summarize this call, highlight action items..."
                required></textarea>

      <div class="row spaced">
        <button type="button" id="promptMicBtn" class="chip">
          <span class="chip-icon mic-icon"></span>
          <span>Speak prompt</span>
        </button>
        <small id="promptMicStatus" class="hint">Click to record prompt audio.</small>
      </div>

      <input type="hidden" name="prompt_audio" id="promptAudioField">
    </section>

    <!-- Audio panel -->
    <section class="card">
      <h2>Audio input</h2>
      <p class="muted">Upload an existing file or record live from your mic.</p>

      <label class="field">
        <span>Upload file</span>
        <input type="file" name="audio_file" accept="audio/*">
      </label>

      <div class="live-wrapper">
        <button type="button" id="liveMicBtn" class="live-mic">
          <span class="live-ring"></span>
          <span class="live-glyph"></span>
        </button>
        <div class="live-copy">
          <span class="live-title">Live capture</span>
          <span id="liveStatus" class="hint">Tap to start recording.</span>
        </div>
      </div>

      <div class="field">
        <span>Output type</span>
        <div class="options">
          <label><input type="radio" name="output_type" value="asr" checked> ASR</label>
          <label><input type="radio" name="output_type" value="classification"> Classification</label>
          <label><input type="radio" name="output_type" value="generation"> Generation</label>
        </div>
      </div>

      <input type="hidden" name="live_filename" id="liveAudioField">
      <button type="submit" class="btn primary full" id="runBtn">
        <span class="btn-label">Run pipeline</span>
        <span class="btn-spinner"></span>
      </button>
    </section>
  </form>

  <section class="card result-card {% if result_text or audio_filename %}active{% endif %}">
    <div class="result-header">
      <span>Result</span>
      <span class="dot-indicator" id="resultIndicator"></span>
    </div>

    <div class="result-body">
      <div class="result-text">
        {{ result_text or "Results will appear here after processing." }}
      </div>
      <div class="result-audio">
        {% if audio_filename %}
          <audio controls>
            <source src="{{ url_for('media', filename=audio_filename) }}" type="audio/webm">
          </audio>
          <a class="btn ghost small"
             href="{{ url_for('media', filename=audio_filename) }}">
            Download audio
          </a>
        {% else %}
          <p class="muted">No audio output yet.</p>
        {% endif %}
      </div>
    </div>
  </section>

</div>
{% endblock %}
